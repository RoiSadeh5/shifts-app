<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0f172a">
  <title>×©×›×´×©</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f172a;
      --card: #1e293b;
      --card-alt: #1a2332;
      --accent: #6366f1;
      --accent-light: #818cf8;
      --green: #10b981;
      --green-dim: rgba(16,185,129,0.12);
      --orange: #f59e0b;
      --orange-dim: rgba(245,158,11,0.12);
      --red: #ef4444;
      --red-dim: rgba(239,68,68,0.10);
      --blue: #38bdf8;
      --blue-dim: rgba(56,189,248,0.12);
      --accent-dim: rgba(99,102,241,0.12);
      --text: #f1f5f9;
      --text-secondary: #94a3b8;
      --text-dim: #64748b;
      --border: rgba(148,163,184,0.1);
      --border-strong: rgba(148,163,184,0.15);
      --radius: 16px;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Heebo', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      min-height: 100dvh;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
      padding-bottom: calc(80px + var(--safe-bottom));
    }

    /* ===== HEADER ===== */
    .header {
      padding: 54px 20px 12px;
      position: sticky;
      top: 0;
      z-index: 100;
      background: linear-gradient(to bottom, var(--bg) 60%, transparent);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }
    .header h1 {
      font-size: 26px;
      font-weight: 900;
      background: linear-gradient(135deg, #818cf8 0%, #10b981 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }

    /* ===== BOTTOM TABS ===== */
    .tab-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(15,23,42,0.88);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-around;
      padding: 6px 0 calc(6px + var(--safe-bottom));
      z-index: 200;
    }
    .tab {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      cursor: pointer;
      padding: 6px 10px;
      border: none;
      background: none;
      color: var(--text-dim);
      font-family: 'Heebo', sans-serif;
      font-size: 10px;
      font-weight: 600;
      transition: color 0.2s;
    }
    .tab svg { width: 22px; height: 22px; }
    .tab.active { color: var(--accent-light); }

    /* ===== PAGES ===== */
    .page { display: none; padding: 0 16px 20px; max-width: 500px; margin: 0 auto; }
    .page.active { display: block; animation: fadeIn 0.3s ease; }

    /* ===== MONTH SELECTOR ===== */
    .month-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin: 6px 0 18px;
    }
    .month-nav button {
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      width: 36px;
      height: 36px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s;
    }
    .month-nav button:active { background: var(--border-strong); }
    .month-nav .label {
      font-size: 16px;
      font-weight: 700;
      min-width: 140px;
      text-align: center;
      color: var(--text);
    }

    /* ===== HERO CARDS (Premium Bank Style) ===== */
    .dual-hero {
      display: grid;
      grid-template-columns: 1.3fr 1fr;
      gap: 12px;
      margin-bottom: 14px;
    }

    .hero-card {
      border-radius: 22px;
      padding: 20px 18px;
      position: relative;
      overflow: hidden;
    }
    .hero-card .hero-glow {
      position: absolute;
      border-radius: 50%;
      filter: blur(40px);
      pointer-events: none;
    }
    .hero-card .hero-label {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 6px;
      position: relative;
      z-index: 1;
    }
    .hero-card .hero-value {
      font-weight: 900;
      direction: ltr;
      text-align: right;
      letter-spacing: -1px;
      position: relative;
      z-index: 1;
    }
    .hero-card .hero-sub {
      font-size: 12px;
      margin-top: 4px;
      position: relative;
      z-index: 1;
    }

    .hero-card.net-card {
      background: linear-gradient(135deg, rgba(16,185,129,0.08) 0%, rgba(16,185,129,0.18) 100%);
      border: 1px solid rgba(16,185,129,0.2);
      backdrop-filter: blur(12px);
    }
    .hero-card.net-card .hero-glow {
      width: 100px;
      height: 100px;
      background: rgba(16,185,129,0.12);
      bottom: -30px;
      left: -30px;
    }
    .hero-card.net-card .hero-label { color: rgba(16,185,129,0.7); }
    .hero-card.net-card .hero-value { font-size: 36px; color: #10b981; }
    .hero-card.net-card .hero-sub { color: rgba(16,185,129,0.5); }

    .hero-card.gross-card {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border: 1px solid var(--border-strong);
      box-shadow: 0 4px 24px rgba(0,0,0,0.2);
    }
    .hero-card.gross-card .hero-glow {
      width: 120px;
      height: 120px;
      background: rgba(99,102,241,0.07);
      top: -40px;
      right: -40px;
    }
    .hero-card.gross-card .hero-label { color: var(--text-dim); }
    .hero-card.gross-card .hero-value { font-size: 26px; color: var(--text); }
    .hero-card.gross-card .hero-sub { color: var(--text-dim); }

    .hero-projection {
      font-size: 11px;
      font-weight: 600;
      margin-top: 6px;
      padding: 3px 8px;
      border-radius: 8px;
      background: rgba(99,102,241,0.12);
      color: var(--accent-light);
      position: relative;
      z-index: 1;
      display: inline-block;
    }

    /* ===== STATS GRID ===== */
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-bottom: 18px;
    }
    .mini-stat {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px 8px;
      text-align: center;
    }
    .mini-stat .ms-val { font-size: 20px; font-weight: 800; }
    .mini-stat .ms-label { font-size: 10px; color: var(--text-dim); margin-top: 2px; font-weight: 500; }
    .ms-val.accent { color: var(--accent-light); }
    .ms-val.green { color: var(--green); }
    .ms-val.orange { color: var(--orange); }

    /* ===== DEDUCTIONS / EMPLOYER PANELS ===== */
    .deductions-panel, .employer-panel {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 12px;
      transition: border-color 0.2s;
    }
    .deductions-panel { border-color: rgba(239,68,68,0.15); }
    .employer-panel { border-color: rgba(16,185,129,0.15); }

    .ded-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      cursor: pointer;
    }
    .ded-header .ded-title { font-size: 13px; font-weight: 700; color: var(--text-secondary); }
    .ded-header .ded-total { font-size: 15px; font-weight: 800; }
    .ded-header .ded-arrow {
      font-size: 10px;
      color: var(--text-dim);
      transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
      margin-right: 6px;
    }

    .ded-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.35s cubic-bezier(0.4,0,0.2,1);
    }
    .ded-body.open { max-height: 600px; }

    .ded-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 16px;
      border-top: 1px solid var(--border);
      font-size: 13px;
    }
    .ded-row .ded-name { color: var(--text-dim); font-weight: 400; }
    .ded-row .ded-val { font-weight: 700; font-variant-numeric: tabular-nums; }
    .ded-row .ded-val.red { color: var(--red); }
    .ded-row .ded-val.green { color: var(--green); }

    /* ===== SETTINGS TOGGLES ===== */
    .setting-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      border-bottom: 1px solid var(--border);
    }
    .setting-toggle:last-child { border-bottom: none; }
    .setting-toggle .st-right { display: flex; flex-direction: column; gap: 2px; }
    .setting-toggle .st-label { font-size: 14px; font-weight: 600; }
    .setting-toggle .st-desc { font-size: 11px; color: var(--text-dim); font-weight: 400; }

    /* ===== TYPE BREAKDOWN ===== */
    .breakdown-section { margin-bottom: 18px; }
    .section-label {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 10px;
      color: var(--text-secondary);
    }
    .bd-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 14px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 8px;
    }
    .bd-row .bd-right { display: flex; align-items: center; gap: 10px; }
    .bd-row .bd-dot { width: 8px; height: 8px; border-radius: 50%; }
    .bd-row .bd-name { font-size: 13px; font-weight: 600; }
    .bd-row .bd-count { font-size: 11px; color: var(--text-dim); }
    .bd-row .bd-pay { font-size: 14px; font-weight: 800; font-variant-numeric: tabular-nums; }

    /* ===== SHIFT LIST ===== */
    .shift-item {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px 16px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      animation: fadeIn 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .shift-item .si-right { display: flex; flex-direction: column; gap: 4px; }
    .type-badge {
      display: inline-block;
      font-size: 10px;
      font-weight: 700;
      padding: 3px 10px;
      border-radius: 6px;
      letter-spacing: 0.3px;
    }
    .badge-plus { background: var(--accent-dim); color: var(--accent-light); }
    .badge-training { background: var(--orange-dim); color: var(--orange); }
    .badge-vacation { background: var(--green-dim); color: var(--green); }
    .badge-minus { background: var(--blue-dim); color: var(--blue); }
    .si-date { font-size: 12px; color: var(--text-dim); font-weight: 400; }
    .si-left { text-align: left; display: flex; align-items: center; gap: 10px; }
    .si-pay { font-size: 17px; font-weight: 800; color: var(--green); font-variant-numeric: tabular-nums; }
    .si-hours { font-size: 11px; color: var(--text-dim); }
    .si-delete {
      background: none;
      border: none;
      color: var(--red);
      font-size: 14px;
      cursor: pointer;
      padding: 8px;
      opacity: 0.4;
      transition: opacity 0.15s;
    }
    .si-delete:active { opacity: 1; }

    .empty-state {
      text-align: center;
      padding: 50px 20px;
      color: var(--text-dim);
    }
    .empty-state .empty-icon { font-size: 44px; margin-bottom: 12px; opacity: 0.6; }
    .empty-state .empty-text { font-size: 15px; font-weight: 600; color: var(--text-secondary); }
    .empty-state .empty-hint { font-size: 12px; margin-top: 6px; }

    /* ===== ADD SHIFT PAGE ===== */
    .type-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 18px;
    }
    .type-btn {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 16px 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .type-btn:active { transform: scale(0.96); }
    .type-btn.selected {
      border-color: var(--accent);
      background: var(--accent-dim);
      box-shadow: 0 0 20px rgba(99,102,241,0.1);
    }
    .type-btn .t-icon { font-size: 26px; margin-bottom: 4px; }
    .type-btn .t-name { font-size: 14px; font-weight: 800; }
    .type-btn .t-desc { font-size: 11px; color: var(--text-dim); margin-top: 2px; font-weight: 400; }

    .form-group { margin-bottom: 14px; }
    .form-group label {
      display: block;
      font-size: 12px;
      color: var(--text-dim);
      margin-bottom: 6px;
      font-weight: 600;
    }
    .form-group input, .form-group select {
      width: 100%;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px 16px;
      font-size: 16px;
      font-family: 'Heebo', sans-serif;
      color: var(--text);
      outline: none;
      -webkit-appearance: none;
      direction: ltr;
      text-align: right;
      transition: border-color 0.15s;
    }
    .form-group input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(99,102,241,0.1); }
    .time-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

    .toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 16px;
    }
    .toggle-row span { font-size: 13px; font-weight: 600; }
    .toggle {
      width: 50px;
      height: 28px;
      background: rgba(148,163,184,0.2);
      border-radius: 14px;
      position: relative;
      cursor: pointer;
      transition: background 0.3s cubic-bezier(0.4,0,0.2,1);
    }
    .toggle.on { background: var(--green); }
    .toggle::after {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      background: #fff;
      border-radius: 50%;
      top: 3px;
      right: 3px;
      transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .toggle.on::after { transform: translateX(-22px); }

    .btn-add {
      width: 100%;
      background: linear-gradient(135deg, var(--accent), #4f46e5);
      color: #fff;
      border: none;
      border-radius: 14px;
      padding: 16px;
      font-size: 16px;
      font-family: 'Heebo', sans-serif;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.15s;
      box-shadow: 0 4px 16px rgba(99,102,241,0.25);
    }
    .btn-add:active { transform: scale(0.97); opacity: 0.9; }

    /* Toast */
    .toast {
      position: fixed;
      top: -80px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #10b981, #059669);
      color: #fff;
      padding: 14px 24px;
      border-radius: 14px;
      font-size: 14px;
      font-weight: 700;
      z-index: 999;
      transition: top 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 8px 30px rgba(16,185,129,0.3);
      direction: rtl;
      text-align: center;
      max-width: 90%;
    }
    .toast.show { top: 60px; }

    /* Result panel */
    .result-panel {
      background: linear-gradient(135deg, var(--card), var(--card-alt));
      border: 1px solid rgba(99,102,241,0.2);
      border-radius: 18px;
      padding: 20px;
      margin-top: 18px;
      display: none;
    }
    .result-panel.show { display: block; animation: fadeIn 0.3s ease; }
    .rp-header { font-size: 12px; color: var(--text-dim); margin-bottom: 6px; font-weight: 500; }
    .rp-total { font-size: 34px; font-weight: 900; color: var(--green); direction: ltr; text-align: right; letter-spacing: -1px; }
    .rp-hours { font-size: 13px; color: var(--text-dim); margin-bottom: 14px; }
    .rp-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .rp-item {
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
    }
    .rp-item .rp-label { font-size: 10px; color: var(--text-dim); font-weight: 500; }
    .rp-item .rp-val { font-size: 15px; font-weight: 700; margin-top: 2px; font-variant-numeric: tabular-nums; }

    /* ===== CALENDAR ===== */
    .cal-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-bottom: 20px;
    }
    .cal-header {
      text-align: center;
      font-size: 11px;
      font-weight: 700;
      color: var(--text-dim);
      padding: 8px 0;
    }
    .cal-day {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-dim);
      position: relative;
      gap: 3px;
      cursor: pointer;
      transition: background 0.15s;
    }
    .cal-day:active { background: var(--border); }
    .cal-day.has-shift { color: var(--text); background: var(--card); font-weight: 700; }
    .cal-day.today { border: 1.5px solid var(--accent); }
    .cal-dots { display: flex; gap: 3px; }
    .cal-dot { width: 5px; height: 5px; border-radius: 50%; }
    .dot-plus { background: var(--accent-light); }
    .dot-training { background: var(--orange); }
    .dot-vacation { background: var(--green); }
    .dot-minus { background: var(--blue); }
    .cal-day.empty { visibility: hidden; }

    .cal-day-detail {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .cal-day-detail .cdd-date { font-size: 14px; font-weight: 700; margin-bottom: 10px; }

    /* ===== SETTINGS ===== */
    .setting-group {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 16px;
    }
    .setting-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      border-bottom: 1px solid var(--border);
    }
    .setting-item:last-child { border-bottom: none; }
    .setting-item .si-label { font-size: 13px; font-weight: 600; }
    .setting-item input {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 10px;
      font-size: 14px;
      font-family: 'Heebo', sans-serif;
      color: var(--text);
      width: 80px;
      text-align: center;
      direction: ltr;
      outline: none;
      transition: border-color 0.15s;
    }
    .setting-item input:focus { border-color: var(--accent); }

    .btn-danger {
      width: 100%;
      background: var(--red-dim);
      color: var(--red);
      border: 1px solid rgba(239,68,68,0.2);
      border-radius: 14px;
      padding: 14px;
      font-size: 14px;
      font-family: 'Heebo', sans-serif;
      font-weight: 700;
      cursor: pointer;
    }
    .btn-secondary {
      width: 100%;
      background: var(--card);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      font-size: 14px;
      font-family: 'Heebo', sans-serif;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 10px;
      transition: background 0.15s;
    }
    .btn-secondary:active { background: var(--border-strong); }

    .hidden { display: none !important; }

    /* ===== SHARE BUTTON ===== */
    .btn-share {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: linear-gradient(135deg, #25d366, #128c7e);
      color: #fff;
      border: none;
      border-radius: 14px;
      padding: 13px;
      font-size: 14px;
      font-family: 'Heebo', sans-serif;
      font-weight: 700;
      cursor: pointer;
      margin-bottom: 14px;
      transition: all 0.15s;
      box-shadow: 0 4px 16px rgba(37,211,102,0.2);
    }
    .btn-share:active { transform: scale(0.97); opacity: 0.9; }

    /* ===== BACKUP INFO ===== */
    .backup-info {
      text-align: center;
      font-size: 11px;
      font-weight: 500;
      padding: 8px 0;
      margin-bottom: 8px;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ===== ANNUAL / FORM 106 ===== */
    .annual-year-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin: 6px 0 18px;
    }
    .annual-year-nav button {
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      width: 36px;
      height: 36px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .annual-year-nav .label { font-size: 18px; font-weight: 800; min-width: 80px; text-align: center; }

    .f106-hero {
      background: linear-gradient(135deg, rgba(99,102,241,0.1), rgba(99,102,241,0.22));
      border: 1px solid rgba(99,102,241,0.25);
      border-radius: 20px;
      padding: 22px 18px;
      margin-bottom: 16px;
      text-align: center;
    }
    .f106-hero .f106-label { font-size: 12px; color: var(--accent-light); opacity: 0.7; margin-bottom: 4px; }
    .f106-hero .f106-val { font-size: 36px; font-weight: 900; color: var(--accent-light); direction: ltr; letter-spacing: -1px; }
    .f106-hero .f106-sub { font-size: 13px; color: var(--text-dim); margin-top: 4px; }

    .f106-table {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 16px;
    }
    .f106-table .f106-title {
      padding: 14px 16px 8px;
      font-size: 13px;
      font-weight: 700;
      color: var(--text-secondary);
    }
    .f106-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 16px;
      border-top: 1px solid var(--border);
      font-size: 13px;
    }
    .f106-row.total {
      background: rgba(255,255,255,0.02);
      font-weight: 800;
      font-size: 14px;
    }
    .f106-row .f106-name { color: var(--text-dim); }
    .f106-row .f106-amount { font-weight: 700; font-variant-numeric: tabular-nums; }
    .f106-amount.red { color: var(--red); }
    .f106-amount.green { color: var(--green); }

    .history-month-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .hm-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      cursor: pointer;
    }
    .hm-header .hm-month { font-size: 14px; font-weight: 700; }
    .hm-header .hm-gross { font-size: 13px; font-weight: 600; color: var(--green); font-variant-numeric: tabular-nums; }
    .hm-header .hm-source { font-size: 10px; padding: 2px 8px; border-radius: 4px; font-weight: 600; }
    .hm-source.auto { background: var(--accent-dim); color: var(--accent-light); }
    .hm-source.manual { background: var(--orange-dim); color: var(--orange); }
    .hm-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .hm-body.open { max-height: 500px; }
    .hm-fields { padding: 8px 16px 14px; }
    .hm-field {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .hm-field label {
      font-size: 12px;
      color: var(--text-dim);
      font-weight: 500;
    }
    .hm-field input {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 7px 10px;
      font-size: 13px;
      font-family: 'Heebo', sans-serif;
      color: var(--text);
      width: 100px;
      text-align: center;
      direction: ltr;
      outline: none;
    }
    .hm-field input:focus { border-color: var(--accent); }

    .tab-switch {
      display: flex;
      gap: 0;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 18px;
    }
    .tab-switch button {
      flex: 1;
      padding: 10px;
      font-size: 13px;
      font-family: 'Heebo', sans-serif;
      font-weight: 600;
      background: transparent;
      color: var(--text-dim);
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    .tab-switch button.active {
      background: var(--accent-dim);
      color: var(--accent-light);
    }

    /* ===== CONFIRM DIALOG ===== */
    .confirm-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .confirm-overlay.visible { opacity: 1; }
    .confirm-box {
      background: var(--card);
      border: 1px solid var(--border-strong);
      border-radius: 20px;
      padding: 28px 24px 20px;
      width: min(340px, 85vw);
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    }
    .confirm-title { font-size: 18px; font-weight: 800; margin-bottom: 10px; }
    .confirm-msg { font-size: 14px; color: var(--text-secondary); margin-bottom: 22px; line-height: 1.5; }
    .confirm-btns { display: flex; gap: 10px; }
    .confirm-cancel {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      font-family: 'Heebo', sans-serif;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      background: var(--bg);
      color: var(--text-secondary);
      border: 1px solid var(--border);
    }
    .confirm-ok {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      font-family: 'Heebo', sans-serif;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      background: var(--red);
      color: #fff;
      border: none;
    }

    .badge-sick { background: var(--red-dim); color: var(--red); }
    .dot-sick { background: var(--red); }

    .leave-balance {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 18px;
    }
    .leave-item {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px 8px;
      text-align: center;
    }
    .leave-item .leave-val { font-size: 20px; font-weight: 800; }
    .leave-item .leave-label { font-size: 10px; color: var(--text-dim); margin-top: 2px; font-weight: 500; display: block; }
    .leave-val.green { color: var(--green); }
    .leave-val.orange { color: var(--orange); }

    /* Payslip comparison panel */
    .comparison-panel {
      background: var(--card);
      border: 1px solid rgba(99,102,241,0.2);
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 12px;
    }
    .cmp-header-row {
      display: grid;
      grid-template-columns: 1.2fr 1fr 1fr 1fr;
      padding: 10px 14px 6px;
      font-size: 10px;
      font-weight: 700;
      color: var(--text-dim);
    }
    .cmp-row {
      display: grid;
      grid-template-columns: 1.2fr 1fr 1fr 1fr;
      padding: 8px 14px;
      font-size: 12px;
      border-top: 1px solid var(--border);
      align-items: center;
    }
    .cmp-name { font-weight: 600; color: var(--text-secondary); }
    .cmp-val { font-weight: 700; font-variant-numeric: tabular-nums; text-align: center; }
    .cmp-val.green { color: var(--green); }
    .cmp-val.red { color: var(--red); }

    /* Payslip entry modal */
    .ps-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .ps-overlay.visible { opacity: 1; }
    .ps-box {
      background: var(--card);
      border: 1px solid var(--border-strong);
      border-radius: 20px;
      padding: 24px 20px 20px;
      width: min(380px, 90vw);
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    }
    .ps-title { font-size: 17px; font-weight: 800; text-align: center; margin-bottom: 4px; }
    .ps-subtitle { font-size: 12px; color: var(--text-dim); text-align: center; margin-bottom: 16px; }
    .ps-field { margin-bottom: 10px; }
    .ps-field label { display: block; font-size: 11px; color: var(--text-dim); margin-bottom: 4px; font-weight: 600; }
    .ps-field input {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 15px;
      font-family: 'Heebo', sans-serif;
      color: var(--text);
      outline: none;
      direction: ltr;
      text-align: right;
    }
    .ps-field input:focus { border-color: var(--accent); }

    /* Numeric inputs: mobile keyboard + tap target */
    input[type="number"],
    .input-numeric {
      font-size: 1.2rem !important;
      min-height: 48px;
      min-width: 80px;
    }
    .ps-sep { font-size: 11px; color: var(--text-dim); font-weight: 700; margin: 14px 0 8px; padding-top: 10px; border-top: 1px solid var(--border); }
    .ps-btns { display: flex; gap: 10px; margin-top: 16px; }
    .ps-btns button {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      font-family: 'Heebo', sans-serif;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
    }
    .ps-cancel { background: var(--bg); color: var(--text-secondary); border: 1px solid var(--border); }
    .ps-save { background: linear-gradient(135deg, var(--accent), #4f46e5); color: #fff; border: none; }

    .btn-payslip {
      background: var(--accent-dim);
      color: var(--accent-light);
      border: 1px solid rgba(99,102,241,0.2);
      border-radius: 10px;
      padding: 8px 14px;
      font-size: 12px;
      font-family: 'Heebo', sans-serif;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.15s;
    }
    .btn-payslip:active { transform: scale(0.96); }

    /* Annual Forecast Card */
    .forecast-card {
      background: linear-gradient(135deg, rgba(99,102,241,0.08) 0%, rgba(99,102,241,0.14) 100%);
      border: 1px solid rgba(99,102,241,0.25);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 14px;
    }
    .forecast-title { font-size: 14px; font-weight: 800; color: var(--accent-light); margin-bottom: 10px; }
    .forecast-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
    .forecast-row:last-child { margin-bottom: 0; }
    .forecast-label { font-size: 12px; color: var(--text-secondary); }
    .forecast-val { font-size: 15px; font-weight: 800; direction: ltr; }

    /* Greeting fade-in */
    @keyframes greetFadeIn {
      from { opacity: 0; transform: translateY(-8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .greeting-animated {
      animation: greetFadeIn 0.6s ease-out both;
    }

    /* Onboarding overlay */
    .onboarding-overlay {
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: rgba(15,23,42,0.92);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.35s ease;
      pointer-events: none;
    }
    .onboarding-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }
    .onboarding-card {
      background: var(--card);
      border: 1px solid var(--border-strong);
      border-radius: 24px;
      padding: 36px 28px 30px;
      width: min(340px, 88vw);
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      transform: scale(0.92);
      transition: transform 0.35s ease;
    }
    .onboarding-overlay.visible .onboarding-card {
      transform: scale(1);
    }
    .onboarding-emoji {
      font-size: 48px;
      margin-bottom: 14px;
    }
    .onboarding-title {
      font-size: 20px;
      font-weight: 800;
      color: var(--text);
      margin-bottom: 8px;
      line-height: 1.4;
    }
    .onboarding-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 22px;
    }
    .onboarding-input {
      width: 100%;
      padding: 14px 16px;
      font-size: 18px;
      font-family: 'Heebo', sans-serif;
      font-weight: 600;
      background: var(--bg);
      color: var(--text);
      border: 2px solid var(--border-strong);
      border-radius: 14px;
      text-align: center;
      outline: none;
      transition: border-color 0.2s;
      margin-bottom: 18px;
    }
    .onboarding-input:focus {
      border-color: var(--accent);
    }
    .onboarding-input::placeholder {
      color: var(--text-dim);
      font-weight: 400;
    }
    .onboarding-btn {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      font-weight: 700;
      font-family: 'Heebo', sans-serif;
      color: #fff;
      background: linear-gradient(135deg, var(--accent) 0%, #818cf8 100%);
      border: none;
      border-radius: 14px;
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s;
      box-shadow: 0 4px 16px rgba(99,102,241,0.3);
    }
    .onboarding-btn:active {
      transform: scale(0.97);
    }

    /* Pull-to-refresh indicator */
    .ptr-indicator {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translate(-50%, -100%);
      z-index: 300;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 20px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 0 0 16px 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      transition: transform 0.25s ease;
    }
    .ptr-indicator.visible { transform: translate(-50%, 0); }
    .ptr-spinner {
      width: 22px;
      height: 22px;
      border: 2px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: ptr-spin 0.7s linear infinite;
    }
    @keyframes ptr-spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

  <!-- Pull-to-refresh indicator (hidden by default) -->
  <div class="ptr-indicator" id="ptrIndicator" aria-hidden="true">
    <div class="ptr-spinner"></div>
    <span>××¨×¢× ×Ÿ...</span>
  </div>

  <!-- Onboarding modal (first-time only) -->
  <div class="onboarding-overlay" id="onboardingOverlay">
    <div class="onboarding-card">
      <div class="onboarding-emoji">ğŸ‘‹</div>
      <div class="onboarding-title">×‘×¨×•×›×™× ×”×‘××™× ×œ×©×›×´×©!</div>
      <div class="onboarding-subtitle">××™×š ×œ×§×¨×•× ×œ×š?</div>
      <input class="onboarding-input" id="onboardingName" type="text" inputmode="text" placeholder="×”×©× ×©×œ×š" autocomplete="given-name" autofocus>
      <button class="onboarding-btn" onclick="completeOnboarding()">×™××œ×œ×”, ×‘×•× × ×ª×—×™×œ</button>
    </div>
  </div>

  <div class="header">
    <h1 id="pageTitle">×©×›×´×©</h1>
  </div>

  <!-- ==================== DASHBOARD ==================== -->
  <div class="page active" id="pageDashboard">
    <div class="month-nav">
      <button onclick="changeMonth(-1)">â€º</button>
      <span class="label" id="monthLabel"></span>
      <button onclick="changeMonth(1)">â€¹</button>
    </div>
    <div style="text-align:center;margin-bottom:14px;">
      <button class="btn-payslip" onclick="openPayslipModal()">ğŸ“‹ ×”×–× ×ª ×ª×œ×•×© ×‘×¤×•×¢×œ</button>
    </div>

    <div class="dual-hero">
      <div class="hero-card net-card">
        <div class="hero-glow"></div>
        <div class="hero-label">× ×˜×• ×œ×‘× ×§</div>
        <div class="hero-value" id="heroNet">â‚ª0</div>
        <div class="hero-sub" id="heroNetSub"></div>
        <div class="hero-projection" id="heroNetProj" style="display:none"></div>
      </div>
      <div class="hero-card gross-card">
        <div class="hero-glow"></div>
        <div class="hero-label">×¡×”"×› ×‘×¨×•×˜×•</div>
        <div class="hero-value" id="heroGross">â‚ª0</div>
        <div class="hero-sub" id="heroSub">0 ××©××¨×•×ª Â· 0 ×©×¢×•×ª</div>
        <div class="hero-projection" id="heroGrossProj" style="display:none"></div>
      </div>
    </div>

    <!-- WhatsApp Share Button -->
    <button class="btn-share" id="shareBtn" onclick="shareWhatsApp()" style="display:none;">
      <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
      <span>×©×ª×£ ×¡×™×›×•×</span>
    </button>

    <!-- Deductions breakdown (collapsible) -->
    <div class="deductions-panel" id="deductionsPanel">
      <div class="ded-header" onclick="toggleDeductions()">
        <div style="display:flex;align-items:center;gap:6px;">
          <span class="ded-arrow" id="dedArrow">â–¼</span>
          <span class="ded-title">× ×™×›×•×™×™ ×¢×•×‘×“</span>
        </div>
        <span class="ded-total" id="dedTotal">-â‚ª0</span>
      </div>
      <div class="ded-body" id="dedBody">
        <div class="ded-row"><span class="ded-name">××¡ ×”×›× ×¡×”</span><span class="ded-val red" id="dedIncomeTax">-â‚ª0</span></div>
        <div class="ded-row" id="taxTierRow" style="flex-direction:column;align-items:stretch;gap:4px;display:none">
          <div id="taxTierDetail" style="font-size:11px;color:var(--text-dim);padding-top:0px;"></div>
        </div>
        <div class="ded-row"><span class="ded-name">×¤× ×¡×™×” (6%)</span><span class="ded-val red" id="dedPension">-â‚ª0</span></div>
        <div class="ded-row">
          <span class="ded-name">×§×¨×Ÿ ×”×©×ª×œ××•×ª (2.5%) <span id="studyCap" style="font-size:10px;color:var(--orange);display:none;">×ª×§×¨×”!</span></span>
          <span class="ded-val red" id="dedStudy">-â‚ª0</span>
        </div>
        <div class="ded-row"><span class="ded-name">×‘×™×˜×•×— ×œ××•××™</span><span class="ded-val red" id="dedNI">-â‚ª0</span></div>
        <div class="ded-row"><span class="ded-name">×‘×™×˜×•×— ×‘×¨×™××•×ª</span><span class="ded-val red" id="dedHealth">-â‚ª0</span></div>
        <div class="ded-row" id="niTierRow" style="flex-direction:column;align-items:stretch;gap:4px;display:none">
          <div id="niTierDetail" style="font-size:11px;color:var(--text-dim);padding-top:2px;">
            <div style="display:flex;justify-content:space-between"><span>×œ××•××™: 0.4% ×¢×“ ×ª×§×¨×” Â· 7% ××¢×œ</span><span id="niTier1">â‚ª0</span></div>
            <div style="display:flex;justify-content:space-between"><span>×‘×¨×™××•×ª: 3.1% ×¢×“ ×ª×§×¨×” Â· 5% ××¢×œ</span><span id="niTier2">â‚ª0</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Employer contributions (collapsible) -->
    <div class="employer-panel" id="employerPanel">
      <div class="ded-header" onclick="toggleEmployer()">
        <div style="display:flex;align-items:center;gap:6px;">
          <span class="ded-arrow" id="empArrow">â–¼</span>
          <span class="ded-title">×”×¤×¨×©×•×ª ××¢×¡×™×§</span>
        </div>
        <span class="ded-total" style="color:var(--green)" id="empTotal">+â‚ª0</span>
      </div>
      <div class="ded-body" id="empBody">
        <div class="ded-row"><span class="ded-name">×¤× ×¡×™×” + ×¤×™×¦×•×™×™× (12.5%)</span><span class="ded-val green" id="empPension">+â‚ª0</span></div>
        <div class="ded-row"><span class="ded-name">×§×¨×Ÿ ×”×©×ª×œ××•×ª (7.5%)</span><span class="ded-val green" id="empStudy">+â‚ª0</span></div>
      </div>
    </div>

    <!-- Annual Forecast Card -->
    <div class="forecast-card" id="forecastCard" style="display:none">
      <div class="forecast-title">×ª×—×–×™×ª ×©× ×ª×™×ª</div>
      <div class="forecast-row">
        <span class="forecast-label">×‘×¨×•×˜×• ×©× ×ª×™ ××©×•×¢×¨</span>
        <span class="forecast-val" id="forecastGross">â‚ª0</span>
      </div>
      <div class="forecast-row">
        <span class="forecast-label" id="forecastTaxLabel">××¡ ×©× ×ª×™ ×—×–×•×™</span>
        <span class="forecast-val red" id="forecastTax">â‚ª0</span>
      </div>
    </div>

    <!-- Payslip Comparison Panel -->
    <div class="comparison-panel" id="comparisonPanel" style="display:none">
      <div class="ded-header" onclick="toggleComparison()">
        <div style="display:flex;align-items:center;gap:6px;">
          <span class="ded-arrow" id="cmpArrow">â–¼</span>
          <span class="ded-title" style="color:var(--accent-light)">×”×©×•×•××” ×œ×ª×œ×•×©</span>
        </div>
        <span class="ded-total" style="color:var(--accent-light);font-size:12px">ğŸ“‹</span>
      </div>
      <div class="ded-body" id="cmpBody">
        <div class="cmp-header-row">
          <span></span>
          <span style="text-align:center">×—×™×©×•×‘</span>
          <span style="text-align:center">×‘×¤×•×¢×œ</span>
          <span style="text-align:center">×”×¤×¨×©</span>
        </div>
        <div id="comparisonBody"></div>
      </div>
    </div>

    <div class="stats-grid" id="statsGrid">
      <div class="mini-stat">
        <div class="ms-val accent" id="statHours">0</div>
        <div class="ms-label">×©×¢×•×ª</div>
      </div>
      <div class="mini-stat">
        <div class="ms-val green" id="statShifts">0</div>
        <div class="ms-label">××©××¨×•×ª</div>
      </div>
      <div class="mini-stat">
        <div class="ms-val orange" id="statAvg">â‚ª0</div>
        <div class="ms-label">×××•×¦×¢</div>
      </div>
    </div>

    <div class="leave-balance" id="leaveBalance">
      <div class="leave-item">
        <span class="leave-val green" id="vacBalance">0</span>
        <span class="leave-label">×™××™ ×—×•×¤×© × ×•×ª×¨×•</span>
      </div>
      <div class="leave-item">
        <span class="leave-val orange" id="sickBalance">0</span>
        <span class="leave-label">×™××™ ××—×œ×” × ×•×ª×¨×•</span>
      </div>
    </div>

    <div class="breakdown-section" id="breakdownSection">
      <div class="section-label">×¤×™×¨×•×˜ ×œ×¤×™ ×¡×•×’</div>
      <div id="breakdownList"></div>
    </div>

    <div class="section-label">××©××¨×•×ª ××—×¨×•× ×•×ª</div>
    <div id="recentShifts"></div>
  </div>

  <!-- ==================== ADD SHIFT ==================== -->
  <div class="page" id="pageAdd">
    <div class="section-label" style="margin-bottom:14px;">×¡×•×’ ××©××¨×ª</div>

    <div class="type-grid">
      <div class="type-btn selected" data-type="plus" onclick="selectType('plus')">
        <div class="t-icon">âš¡</div>
        <div class="t-name">×¤×œ×•×¡</div>
        <div class="t-desc">06:00 â†’ 06:00+</div>
      </div>
      <div class="type-btn" data-type="training" onclick="selectType('training')">
        <div class="t-icon">ğŸ¯</div>
        <div class="t-name">××™××•×Ÿ</div>
        <div class="t-desc">06:00 â†’ 20:00</div>
      </div>
      <div class="type-btn" data-type="vacation" onclick="selectType('vacation')">
        <div class="t-icon">ğŸ–ï¸</div>
        <div class="t-name">×—×•×¤×©</div>
        <div class="t-desc">1,750 â‚ª</div>
      </div>
      <div class="type-btn" data-type="sick" onclick="selectType('sick')">
        <div class="t-icon">ğŸ¥</div>
        <div class="t-name">××—×œ×”</div>
        <div class="t-desc">1,750 â‚ª</div>
      </div>
      <div class="type-btn" data-type="minus" onclick="selectType('minus')" style="grid-column:1/-1">
        <div class="t-icon">ğŸ•</div>
        <div class="t-name">×™×“× ×™</div>
        <div class="t-desc">×‘×—×¨ ×©×¢×•×ª</div>
      </div>
    </div>

    <!-- Date / Range -->
    <div class="toggle-row" style="margin-bottom:12px;">
      <span>×˜×•×•×— ×ª××¨×™×›×™×</span>
      <div class="toggle" id="rangeToggle" onclick="toggleRange()"></div>
    </div>

    <div id="singleDateGroup">
      <div class="form-group">
        <label>×ª××¨×™×š</label>
        <input type="date" id="shiftDate">
      </div>
    </div>

    <div id="rangeDateGroup" class="hidden">
      <div class="time-row">
        <div class="form-group">
          <label>×ª××¨×™×š ×”×ª×—×œ×”</label>
          <input type="date" id="rangeStart">
        </div>
        <div class="form-group">
          <label>×ª××¨×™×š ×¡×™×•×</label>
          <input type="date" id="rangeEnd">
        </div>
      </div>
    </div>

    <!-- Time fields for Manual (×™×“× ×™) -->
    <div id="minusFields" class="hidden">
      <div class="time-row">
        <div class="form-group">
          <label>×©×¢×ª ×”×ª×—×œ×”</label>
          <input type="time" id="startTime" value="08:00">
        </div>
        <div class="form-group">
          <label>×©×¢×ª ×¡×™×•×</label>
          <input type="time" id="endTime" value="16:00">
        </div>
      </div>
    </div>

    <div class="toggle-row">
      <span>×‘×•× ×•×¡ ×¨×‘×¢×•× ×™ (3,500 â‚ª)</span>
      <div class="toggle" id="bonusToggle" onclick="toggleBonus()"></div>
    </div>

    <button class="btn-add" onclick="addShift()">â• ×”×•×¡×£ ××©××¨×ª</button>

    <div class="result-panel" id="resultPanel">
      <div class="rp-header">×—×™×©×•×‘ ×”××©××¨×ª</div>
      <div class="rp-total" id="rpPay"></div>
      <div class="rp-hours" id="rpHours"></div>
      <div class="rp-grid" id="rpGrid"></div>
    </div>
  </div>

  <!-- ==================== CALENDAR ==================== -->
  <div class="page" id="pageCalendar">
    <div class="month-nav">
      <button onclick="changeMonth(-1)">â€º</button>
      <span class="label" id="calMonthLabel"></span>
      <button onclick="changeMonth(1)">â€¹</button>
    </div>

    <div class="cal-grid" id="calGrid"></div>
    <div id="calDetails"></div>
  </div>

  <!-- ==================== SETTINGS ==================== -->
  <div class="page" id="pageSettings">
    <div class="section-label" style="margin-bottom:14px;">×¤×¨×•×¤×™×œ</div>
    <div class="setting-group">
      <div class="setting-item">
        <span class="si-label">×©×</span>
        <div><input type="text" id="settingUserName" value="" inputmode="text" placeholder="×”×–×Ÿ ××ª ×©××š" onchange="saveUserNameSetting()" style="font-size:1rem;min-height:44px;padding:8px 12px;border-radius:10px;border:1px solid var(--border-strong);background:var(--bg);color:var(--text);font-family:'Heebo',sans-serif;"></div>
      </div>
    </div>

    <div class="section-label" style="margin-bottom:14px;">×ª×¢×¨×™×¤×™×</div>
    <div class="setting-group">
      <div class="setting-item">
        <span class="si-label">×ª×¢×¨×™×£ ×©×¢×ª×™ ×‘×¡×™×¡×™</span>
        <div><input type="number" id="settingBase" value="75" inputmode="decimal" step="0.01" min="0" onchange="saveSettings()"> â‚ª</div>
      </div>
      <div class="setting-item">
        <span class="si-label">××›×¤×™×œ ×¡×•×£ ×©×‘×•×¢</span>
        <div><input type="number" id="settingWeekend" value="1.5" inputmode="decimal" step="0.01" min="0" onchange="saveSettings()"> Ã—</div>
      </div>
      <div class="setting-item">
        <span class="si-label">×ª×¢×¨×™×£ ×—×•×¤×©/××—×œ×”</span>
        <div><input type="number" id="settingVacation" value="1750" inputmode="decimal" step="0.01" min="0" onchange="saveSettings()"> â‚ª</div>
      </div>
      <div class="setting-item">
        <span class="si-label">×‘×•× ×•×¡ ×¨×‘×¢×•× ×™</span>
        <div><input type="number" id="settingBonus" value="3500" inputmode="decimal" step="0.01" min="0" onchange="saveSettings()"> â‚ª</div>
      </div>
    </div>

    <div class="section-label" style="margin-bottom:14px;">××¡ ×”×›× ×¡×”</div>
    <div class="setting-group">
      <div class="setting-item">
        <span class="si-label">× ×§×•×“×•×ª ×–×™×›×•×™</span>
        <div><input type="number" id="settingCreditPts" value="2.25" inputmode="decimal" step="0.25" min="0" onchange="saveSettings()"></div>
      </div>
      <div class="setting-toggle">
        <div class="st-right">
          <span class="st-label">×—×™×©×•×‘ ×œ×¤×™ ×©× ×ª 2025</span>
          <span class="st-desc">× ×ª×•× ×™ ××¡ + ×‘×™×˜×•×— ×œ××•××™ 2025 (×›×‘×•×™ = 2026)</span>
        </div>
        <div class="toggle" id="toggleTaxYear2025" onclick="toggleDedSetting('taxYear2025')"></div>
      </div>
      <div class="setting-toggle">
        <div class="st-right">
          <span class="st-label">××¡ ×”×›× ×¡×”</span>
          <span class="st-desc">××“×¨×’×•×ª Â· 242 â‚ª ×œ× ×§×•×“×ª ×–×™×›×•×™</span>
        </div>
        <div class="toggle on" id="toggleIncomeTax" onclick="toggleDedSetting('incomeTax')"></div>
      </div>
    </div>

    <div class="section-label" style="margin-bottom:14px;">× ×™×›×•×™×™× (2026)</div>
    <div class="setting-group">
      <div class="setting-toggle">
        <div class="st-right">
          <span class="st-label">×¤× ×¡×™×”</span>
          <span class="st-desc">×¢×•×‘×“ 6% Â· ××¢×¡×™×§ 12.5%</span>
        </div>
        <div class="toggle on" id="togglePension" onclick="toggleDedSetting('pension')"></div>
      </div>
      <div class="setting-toggle">
        <div class="st-right">
          <span class="st-label">×§×¨×Ÿ ×”×©×ª×œ××•×ª</span>
          <span class="st-desc">×¢×•×‘×“ 2.5% Â· ××¢×¡×™×§ 7.5% Â· ×ª×§×¨×” 15,712 â‚ª</span>
        </div>
        <div class="toggle on" id="toggleStudy" onclick="toggleDedSetting('study')"></div>
      </div>
      <div class="setting-toggle">
        <div class="st-right">
          <span class="st-label">×”×¤×¨×©×” ×¢×œ ×›×œ ×”×©×›×¨</span>
          <span class="st-desc">×§×¨×Ÿ ×”×©×ª×œ××•×ª ×œ×œ× ×ª×§×¨×ª 15,712 â‚ª</span>
        </div>
        <div class="toggle" id="toggleStudyFullSalary" onclick="toggleDedSetting('studyFullSalary')"></div>
      </div>
      <div class="setting-toggle">
        <div class="st-right">
          <span class="st-label">×‘×™×˜×•×— ×œ××•××™ + ×‘×¨×™××•×ª</span>
          <span class="st-desc">×œ××•××™ 0.4%+7% Â· ×‘×¨×™××•×ª 3.1%+5%</span>
        </div>
        <div class="toggle on" id="toggleNI" onclick="toggleDedSetting('ni')"></div>
      </div>
      <div class="setting-toggle">
        <div class="st-right">
          <span class="st-label">××¦×‘ ×¤×©×•×˜</span>
          <span class="st-desc">×”×¦×’×ª × ×ª×•× ×™ ×‘×¨×•×˜×• ×•× ×˜×• ×‘×œ×‘×“ ×œ×œ× ×ª×—×–×™×•×ª ×•×˜×‘×œ××•×ª ×”×©×•×•××”</span>
        </div>
        <div class="toggle" id="toggleSimpleMode" onclick="toggleDedSetting('simpleMode')"></div>
      </div>
    </div>

    <div class="section-label" style="margin-bottom:14px;">×™×ª×¨×•×ª ×—×•×¤×© ×•××—×œ×”</div>
    <div class="setting-group">
      <div class="setting-item">
        <span class="si-label">×™××™ ×—×•×¤×©</span>
        <div><input type="number" id="settingVacBal" value="0" min="0" step="1" inputmode="numeric" onchange="saveLeaveSettings()"></div>
      </div>
      <div class="setting-item">
        <span class="si-label">×™××™ ××—×œ×”</span>
        <div><input type="number" id="settingSickBal" value="0" min="0" step="1" inputmode="numeric" onchange="saveLeaveSettings()"></div>
      </div>
    </div>

    <div class="section-label" style="margin-bottom:14px;">×’×™×‘×•×™ ×•×©×—×–×•×¨</div>
    <div class="backup-info" id="lastBackupInfo">×œ× ×‘×•×¦×¢ ×’×™×‘×•×™ ×¢×“×™×™×Ÿ</div>
    <button class="btn-secondary" onclick="exportData()">ğŸ“¤ ×™×™×¦×•× ×’×™×‘×•×™</button>
    <button class="btn-secondary" onclick="document.getElementById('importFile').click()">ğŸ“¥ ×™×™×‘×•× ×’×™×‘×•×™</button>
    <input type="file" id="importFile" accept=".json" class="hidden" onchange="importData(event)">
    <button class="btn-danger" onclick="clearAllData()" style="margin-top:10px;">ğŸ—‘ï¸ ××—×§ ××ª ×›×œ ×”× ×ª×•× ×™×</button>

    <div style="text-align:center;margin-top:30px;padding-bottom:20px;color:var(--text-dim);font-size:11px;line-height:1.6;">
      ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª ×œ-Roi Sadeh - ××•×¢× ×§ ×‘××”×‘×” ×œ×›×œ ×¢×•×‘×“×™ ×”×©×›×´×©
    </div>
  </div>

  <!-- ==================== ANNUAL / FORM 106 ==================== -->
  <div class="page" id="pageAnnual">
    <div class="annual-year-nav">
      <button onclick="changeAnnualYear(-1)">â€º</button>
      <span class="label" id="annualYearLabel"></span>
      <button onclick="changeAnnualYear(1)">â€¹</button>
    </div>

    <div class="tab-switch">
      <button class="active" id="annualTabSummary" onclick="switchAnnualView('summary')">×˜×•×¤×¡ 106</button>
      <button id="annualTabHistory" onclick="switchAnnualView('history')">×ª×œ×•×©×™× ×§×•×“××™×</button>
    </div>

    <!-- Form 106 Summary -->
    <div id="annualSummaryView">
      <div class="f106-hero">
        <div class="f106-label">× ×˜×• ×©× ×ª×™ (××•××“×Ÿ)</div>
        <div class="f106-val" id="f106Net">â‚ª0</div>
        <div class="f106-sub" id="f106Sub"></div>
      </div>

      <div class="f106-table">
        <div class="f106-title">×”×›× ×¡×•×ª</div>
        <div class="f106-row"><span class="f106-name">×¡×”"×› ×‘×¨×•×˜×• ×©× ×ª×™</span><span class="f106-amount" id="f106Gross">â‚ª0</span></div>
        <div class="f106-row"><span class="f106-name">×—×•×“×©×™× ××“×•×•×—×™×</span><span class="f106-amount" id="f106Months">0</span></div>
      </div>

      <div class="f106-table">
        <div class="f106-title">× ×™×›×•×™×™ ×¢×•×‘×“</div>
        <div class="f106-row"><span class="f106-name">××¡ ×”×›× ×¡×”</span><span class="f106-amount red" id="f106Tax">-â‚ª0</span></div>
        <div class="f106-row"><span class="f106-name">×‘×™×˜×•×— ×œ××•××™ + ×‘×¨×™××•×ª</span><span class="f106-amount red" id="f106NI">-â‚ª0</span></div>
        <div class="f106-row"><span class="f106-name">×¤× ×¡×™×” (×¢×•×‘×“)</span><span class="f106-amount red" id="f106Pension">-â‚ª0</span></div>
        <div class="f106-row"><span class="f106-name">×§×¨×Ÿ ×”×©×ª×œ××•×ª (×¢×•×‘×“)</span><span class="f106-amount red" id="f106Study">-â‚ª0</span></div>
        <div class="f106-row total"><span class="f106-name">×¡×”"×› × ×™×›×•×™×™×</span><span class="f106-amount red" id="f106TotalDed">-â‚ª0</span></div>
      </div>

      <div class="f106-table">
        <div class="f106-title">×”×¤×¨×©×•×ª ××¢×¡×™×§</div>
        <div class="f106-row"><span class="f106-name">×¤× ×¡×™×” + ×¤×™×¦×•×™×™×</span><span class="f106-amount green" id="f106EmpPension">+â‚ª0</span></div>
        <div class="f106-row"><span class="f106-name">×§×¨×Ÿ ×”×©×ª×œ××•×ª</span><span class="f106-amount green" id="f106EmpStudy">+â‚ª0</span></div>
        <div class="f106-row total"><span class="f106-name">×¡×”"×› ×”×¤×¨×©×•×ª</span><span class="f106-amount green" id="f106EmpTotal">+â‚ª0</span></div>
      </div>

      <div class="f106-table" id="f106CumulativeSection" style="display:none">
        <div class="f106-title">× ×ª×•× ×™× ××¦×˜×‘×¨×™× (××ª×œ×•×©×™×)</div>
        <div class="f106-row"><span class="f106-name">×ª×œ×•×©×™× ×©×”×•×–× ×•</span><span class="f106-amount" id="f106ManualCount">â€”</span></div>
        <div class="f106-row"><span class="f106-name">×××•×¦×¢ ×‘×¨×•×˜×• ×—×•×“×©×™</span><span class="f106-amount" id="f106AvgGross">â€”</span></div>
        <div class="f106-row"><span class="f106-name">×‘×¨×•×˜×• ××¦×˜×‘×¨ ×œ××¡</span><span class="f106-amount" id="f106CumTax">â€”</span></div>
        <div class="f106-row"><span class="f106-name">×‘×¨×•×˜×• ××¦×˜×‘×¨ ×œ×§×”"×©</span><span class="f106-amount" id="f106CumStudy">â€”</span></div>
      </div>
    </div>

    <!-- Past Paychecks -->
    <div id="annualHistoryView" class="hidden">
      <div style="font-size:12px;color:var(--text-dim);margin-bottom:14px;text-align:center;">
        ×”×–×Ÿ × ×ª×•× ×™ ×ª×œ×•×©×™× ××—×•×“×©×™× ×§×•×“××™× ×œ×—×™×©×•×‘ ×©× ×ª×™ ××“×•×™×§
      </div>
      <div id="historyMonthsList"></div>
    </div>
  </div>

  <!-- Payslip Entry Modal -->
  <div class="ps-overlay" id="payslipOverlay" onclick="if(event.target===this)closePayslipModal()">
    <div class="ps-box">
      <div class="ps-title">×”×–× ×ª ×ª×œ×•×© ×‘×¤×•×¢×œ</div>
      <div class="ps-subtitle" id="psMonthLabel"></div>
      <div class="ps-field"><label>×‘×¨×•×˜×• ×‘×¤×•×¢×œ</label><input type="number" id="psGross" placeholder="0" inputmode="decimal" step="0.01" min="0"></div>
      <div class="ps-field"><label>× ×˜×• ×‘×¤×•×¢×œ</label><input type="number" id="psNet" placeholder="0" inputmode="decimal" step="0.01" min="0"></div>
      <div class="ps-field"><label>××¡ ×”×›× ×¡×”</label><input type="number" id="psTax" placeholder="0" inputmode="decimal" step="0.01" min="0"></div>
      <div class="ps-field"><label>×‘×™×˜×•×— ×œ××•××™</label><input type="number" id="psNI" placeholder="0" inputmode="decimal" step="0.01" min="0"></div>
      <div class="ps-field"><label>×‘×™×˜×•×— ×‘×¨×™××•×ª</label><input type="number" id="psHealth" placeholder="0" inputmode="decimal" step="0.01" min="0"></div>
      <div class="ps-field"><label>×¤× ×¡×™×” ×¢×•×‘×“</label><input type="number" id="psPension" placeholder="0" inputmode="decimal" step="0.01" min="0"></div>
      <div class="ps-field"><label>×§×¨×Ÿ ×”×©×ª×œ××•×ª ×¢×•×‘×“</label><input type="number" id="psStudy" placeholder="0" inputmode="decimal" step="0.01" min="0"></div>
      <div class="ps-sep">× ×ª×•× ×™× ××¦×˜×‘×¨×™× (××”×ª×œ×•×©)</div>
      <div class="ps-field"><label>×‘×¨×•×˜×• ××¦×˜×‘×¨ ×œ××¡ (×©× ×ª×™)</label><input type="number" id="psCumTax" placeholder="0" inputmode="decimal" step="0.01" min="0"></div>
      <div class="ps-field"><label>×‘×¨×•×˜×• ××¦×˜×‘×¨ ×œ×§×”"×© (×©× ×ª×™)</label><input type="number" id="psCumStudy" placeholder="0" inputmode="decimal" step="0.01" min="0"></div>
      <div class="ps-btns" style="flex-direction:column;">
        <button class="ps-recalc" style="background:var(--card-alt);color:var(--text-secondary);border:1px solid var(--border);margin-bottom:6px;" onclick="recalcPayslipFromGross()">×—×©×‘ ×œ×¤×™ ×‘×¨×•×˜×• (×”×¦×¢×”)</button>
        <div style="display:flex;gap:10px;">
          <button class="ps-cancel" onclick="closePayslipModal()">×‘×™×˜×•×œ</button>
          <button class="ps-save" onclick="savePayslipModal()">×©××•×¨ ×ª×œ×•×©</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- ==================== BOTTOM TAB BAR ==================== -->
  <nav class="tab-bar">
    <button class="tab active" onclick="switchTab('Dashboard')" id="tabDashboard">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
      <span>×¨××©×™</span>
    </button>
    <button class="tab" onclick="switchTab('Add')" id="tabAdd">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
      <span>×”×•×¡×¤×”</span>
    </button>
    <button class="tab" onclick="switchTab('Calendar')" id="tabCalendar">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
      <span>×œ×•×— ×©× ×”</span>
    </button>
    <button class="tab" onclick="switchTab('Annual')" id="tabAnnual">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
      <span>×©× ×ª×™</span>
    </button>
    <button class="tab" onclick="switchTab('Settings')" id="tabSettings">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
      <span>×”×’×“×¨×•×ª</span>
    </button>
  </nav>

  <!-- ==================== SCRIPTS ==================== -->
  <script src="src/logic/salaryEngine.js"></script>
  <script src="src/app.js"></script>
  <script src="src/store/dataManager.js"></script>
  <script src="src/components/Dashboard.js"></script>
  <script src="src/components/ShiftForm.js"></script>
  <script src="src/components/AnnualSummary.js"></script>
  <script src="src/components/settings.js"></script>
  <script>
    init();
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js');
    }

    // Pull-to-refresh: only when scroll at top, minimal interference with normal scroll
    (function() {
      var PTR_THRESHOLD = 60;
      var ptrStartY = 0;
      var ptrCurrentY = 0;
      var ptrArmed = false;
      var ptrIndicator = document.getElementById('ptrIndicator');

      function getScrollTop() {
        var s = window.scrollY;
        if (typeof s !== 'number') s = document.documentElement.scrollTop || document.body.scrollTop || 0;
        return s;
      }

      function runRefresh() {
        console.log('Refresh Triggered');
        if (navigator.vibrate) navigator.vibrate(10);
        ptrIndicator.classList.add('visible');
        ptrIndicator.setAttribute('aria-hidden', 'false');

        if (typeof loadHistory === 'function' && typeof saveHistory === 'function') {
          try { saveHistory(loadHistory()); } catch (err) {}
        }
        if (typeof loadSettings === 'function') loadSettings();

        if (document.getElementById('pageDashboard').classList.contains('active')) {
          if (typeof recalcAll === 'function') recalcAll();
          if (typeof renderCalendar === 'function') renderCalendar();
        } else if (document.getElementById('pageAnnual').classList.contains('active')) {
          if (typeof renderAnnual === 'function') renderAnnual();
        } else if (document.getElementById('pageCalendar').classList.contains('active')) {
          if (typeof renderCalendar === 'function') renderCalendar();
        }

        setTimeout(function() {
          ptrIndicator.classList.remove('visible');
          ptrIndicator.setAttribute('aria-hidden', 'true');
        }, 400);
      }

      document.body.addEventListener('touchstart', function(e) {
        if (e.touches.length !== 1) return;
        ptrArmed = getScrollTop() <= 0;
        ptrStartY = e.touches[0].clientY;
        ptrCurrentY = ptrStartY;
      }, { passive: true });

      document.body.addEventListener('touchmove', function(e) {
        if (!ptrArmed || e.touches.length !== 1) return;
        ptrCurrentY = e.touches[0].clientY;
        if (getScrollTop() > 0) { ptrArmed = false; }
      }, { passive: true });

      document.body.addEventListener('touchend', function() {
        if (!ptrArmed) { ptrArmed = false; return; }
        var pullDistance = ptrCurrentY - ptrStartY;
        ptrArmed = false;
        if (getScrollTop() <= 0 && pullDistance >= PTR_THRESHOLD) {
          runRefresh();
        }
      }, { passive: true });
    })();
  </script>
</body>
</html>
